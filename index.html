<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form PreOp Forklift</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 10px;
            table-layout: fixed;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
            vertical-align: top;
            word-wrap: break-word;
            overflow-wrap: break-word;
            white-space: normal;
        }
        
        th {
            background-color: #4CAF50;
            color: white;
            font-weight: bold;
        }
        
        .header-table th {
            background-color: #fff;
        }
        
        .body-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        .body-table tr:hover {
            background-color: #f5f5f5;
        }
        
        .table-title {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            margin: 10px 0 10px 0;
        }
        
        .company-name {
            text-align: center;
            font-size: 14px;
            font-weight: bold;
            color: #000;
            margin: 10px 0;
        }
        
        .footer-table {
            margin-top: 20px;
        }
        
        .footer-table td {
            text-align: center;
            vertical-align: middle;
            width: 50%;
            height: 50px;
            font-weight: bold;
            background-color: #fff;
            border: none;
        }
        
        .signature-row {
            height: 50px;
            background-color: #fff;
        }
        
        .name-row {
            height: 20px;
            background-color: #fff;
            font-size: 12px;
        }
        
        .signature-row td,
        .name-row td {
            border: none;
        }
        
        .qr-code {
            width: 50px;
            height: 50px;
            margin: 5px auto;
            display: block;
        }
        
        .buttons {
            text-align: center;
            margin: 20px 0;
            gap: 10px;
        }
        
        .btn {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin: 0 5px;
        }
        
        .btn:hover {
            background-color: #0056b3;
        }
        
        .btn-success {
            background-color: #28a745;
        }
        
        .btn-success:hover {
            background-color: #1e7e34;
        }
        
        .answer-cell {
            text-align: center;
            font-weight: bold;
            font-size: 18px;
        }
        
        @media print {
            body {
                background-color: white;
                padding: 0;
                margin: 0;
            }
            .container {
                box-shadow: none;
                max-width: none;
                margin: 0;
                padding: 0;
            }
            .buttons {
                display: none;
            }
            
            .body-table tr:nth-child(even) {
                background-color: white !important;
            }
            
            @page {
                size: A4;
                margin: 5mm;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="printArea">
            <div class="table-title"></div>
            <table class="header-table">
              <colgroup>
        <col style="width:80px"> 
        <col style="width:145px"> 
        <col style="width:60px"> 
        <col style="width:60px">
    </colgroup>
              
                <tbody>
                    <tr>
                        <td rowspan="5" style="text-align: center; vertical-align: middle;">
                             <img src='https://cdn.jsdelivr.net/gh/riep31/assets@main/logos/logodagsap1080x572.png' width='140' height='80' style='margin-right: 10px; padding: 1px;'>
                             <div class="company-name">PT.DAGSAP ENDURA EATORE</div>
                        </td>
                        <td rowspan="5" style="text-align: center; vertical-align: middle; font-size: 22px; font-weight: bold; color: #333;">
                            FORM PRA OPERASIONAL FORKLIFT
                        </td>
                        <td>Nomor Dokumen</td>
                        <td>DEE-YD-SX-XX-017-19</td>
                    </tr>
                    <tr>
                        <td>Status Dokumen</td>
                        <td>Dikendalikan</td>
                    </tr>
                    <tr>
                        <td>Revisi</td>
                        <td>02</td>
                    </tr>
                    <tr>
                        <td>Tanggal Terbit</td>
                        <td>01 Oktober 2019</td>
                    </tr>
                    <tr>
                        <td>Halaman</td>
                        <td>1 dari 1</td>
                    </tr>
                </tbody>
            </table>
            
            <div class="table-title" id="jenisForklift">Jenis Forklift :</div>
            <table class="body-table">
              <colgroup>
        <col style="width:25px">
        <col style="width:200px">
        <col style="width:60px">
        <col style="width:60px">
    </colgroup>
              
              
               <thead>
    <tr>
        <th rowspan="2" style="background-color:#4CAF50; color:white; text-align:center; vertical-align:middle;">
            NO.
        </th>
        <th style="background-color:#4CAF50; color:white; text-align:center;">
            Tanggal pengecekan/ shift 
        </th>
      <th style="background-color:#4CAF50; color:white;" id="headerTanggal">-</th>
        <th style="background-color:#4CAF50; color:white;" id="headerShift">-</th>
    </tr>
    <tr>
        <th style="background-color:#4CAF50; color:white; text-align:center;">Kegiatan Pra Operasional </th>
        <th style="background-color:#4CAF50; color:white;">Jawaban Ya</th>
        <th style="background-color:#4CAF50; color:white;">Jawaban Tidak</th>
    </tr>
</thead>

                <tbody>
                    <tr>
                        <td>1</td>
                        <td>Unit dalam keadaan bersih dari debu, kotoran lain, dan kondensasi?</td>
                        <td class="answer-cell" id="q1_ya">-</td>
                        <td class="answer-cell" id="q1_tidak">-</td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td>Air accu, garis atau strip putih pelampung terlihat diatas permukaan?</td>
                        <td class="answer-cell" id="q2_ya">-</td>
                        <td class="answer-cell" id="q2_tidak">-</td>
                    </tr>
                    <tr>
                        <td>3</td>
                        <td>Selang angin atau minyak tidak pecah?</td>
                        <td class="answer-cell" id="q3_ya">-</td>
                        <td class="answer-cell" id="q3_tidak">-</td>
                    </tr>
                    <tr>
                        <td>4</td>
                        <td>Roda unit dalam kondisi normal?</td>
                        <td class="answer-cell" id="q4_ya">-</td>
                        <td class="answer-cell" id="q4_tidak">-</td>
                    </tr>
                    <tr>
                        <td>5</td>
                        <td>Soket battre tidak pecah?</td>
                        <td class="answer-cell" id="q5_ya">-</td>
                        <td class="answer-cell" id="q5_tidak">-</td>
                    </tr>
                    <tr>
                        <td>6</td>
                        <td>Minyak hidrolik cukup?</td>
                        <td class="answer-cell" id="q6_ya">-</td>
                        <td class="answer-cell" id="q6_tidak">-</td>
                    </tr>
                    <tr>
                        <td>7</td>
                        <td>Level battre cukup atau minimal 3 strip?</td>
                        <td class="answer-cell" id="q7_ya">-</td>
                        <td class="answer-cell" id="q7_tidak">-</td>
                    </tr>
                    <tr>
                        <td>8</td>
                        <td>Level BBM cukup atau minimal 1 strip?</td>
                        <td class="answer-cell" id="q8_ya">-</td>
                        <td class="answer-cell" id="q8_tidak">-</td>
                    </tr>
                    <tr>
                        <td>9</td>
                        <td>Pedal berfungsi normal?</td>
                        <td class="answer-cell" id="q9_ya">-</td>
                        <td class="answer-cell" id="q9_tidak">-</td>
                    </tr>
                    <tr>
                        <td>10</td>
                        <td>Semua tuas berfungsi normal?</td>
                        <td class="answer-cell" id="q10_ya">-</td>
                        <td class="answer-cell" id="q10_tidak">-</td>
                    </tr>
                    <tr>
                        <td>11</td>
                        <td>Lampu berfungsi?</td>
                        <td class="answer-cell" id="q11_ya">-</td>
                        <td class="answer-cell" id="q11_tidak">-</td>
                    </tr>
                    <tr>
                        <td>12</td>
                        <td>Klakson berfungsi?</td>
                        <td class="answer-cell" id="q12_ya">-</td>
                        <td class="answer-cell" id="q12_tidak">-</td>
                    </tr>
                    <tr>
                        <td>13</td>
                        <td>Stir berfungsi normal?</td>
                        <td class="answer-cell" id="q13_ya">-</td>
                        <td class="answer-cell" id="q13_tidak">-</td>
                      </tr>
                  
                  <tr>
                        <td>14</td>
                        <td>Soket battre terkoneksi ke unit?</td>
                        <td class="answer-cell" id="q14_ya">-</td>
                        <td class="answer-cell" id="q14_tidak">-</td>
                    </tr>
                </tbody>
            </table>
            
            <table class="footer-table">
                <tbody>
                    <tr>
                        <td>Dibuat Oleh</td>
                        <td>Diperiksa Oleh</td>
                    </tr>
                    <tr class="signature-row">
                        <td>
                            <img id="qr1" class="qr-code" alt="QR Code Dibuat Oleh">
                        </td>
                        <td>
                            <img id="qr2" class="qr-code" alt="QR Code Diperiksa Oleh">
                        </td>
                    </tr>
                    <tr class="name-row">
                        <td id="name1">-<br>-</td>
                        <td id="name2">-<br>-</td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- Buttons -->
        <div class="buttons">
            <button class="btn" onclick="window.print()">Print Form</button>
            <button class="btn btn-success" onclick="exportToPDF()" id="pdfBtn">Export PDF</button>
        </div>
    </div>
    
    <script>
        (function() {
            const urlParams = new URLSearchParams(window.location.search);
            
            // Get all parameters
            const params = {
                'jenis_forklift': urlParams.get('jenis_forklift') || '',
                'tanggal': urlParams.get('tanggal') || '',
                'shift': urlParams.get('shift') || '',
                'q1': urlParams.get('q1') || '',
                'q2': urlParams.get('q2') || '',
                'q3': urlParams.get('q3') || '',
                'q4': urlParams.get('q4') || '',
                'q5': urlParams.get('q5') || '',
                'q6': urlParams.get('q6') || '',
                'q7': urlParams.get('q7') || '',
                'q8': urlParams.get('q8') || '',
                'q9': urlParams.get('q9') || '',
                'q10': urlParams.get('q10') || '',
                'q11': urlParams.get('q11') || '',
                'q12': urlParams.get('q12') || '',
                'q13': urlParams.get('q13') || '',
                'q14': urlParams.get('q14') || '',
                'sig1': urlParams.get('sig1') || '',
                'sig2': urlParams.get('sig2') || '',
                'name1': urlParams.get('name1') || '',
                'name2': urlParams.get('name2') || ''
            };
            
            // Set Jenis Forklift
            if (params.jenis_forklift) {
                const jenisElement = document.getElementById('jenisForklift');
                if (jenisElement) {
                    jenisElement.textContent = 'Jenis Forklift : ' + decodeURIComponent(params.jenis_forklift);
                }
            }
            
            // Set Tanggal and Shift in header
            if (params.tanggal) {
                const tanggalElement = document.getElementById('headerTanggal');
                if (tanggalElement) {
                    tanggalElement.textContent = decodeURIComponent(params.tanggal);
                }
            }
            
            if (params.shift) {
                const shiftElement = document.getElementById('headerShift');
                if (shiftElement) {
                    shiftElement.textContent = decodeURIComponent(params.shift);
                }
            }
            
            // Function to set answer in table
            function setAnswer(questionNum, answer) {
                const yaCell = document.getElementById(`q${questionNum}_ya`);
                const tidakCell = document.getElementById(`q${questionNum}_tidak`);
                
                if (yaCell && tidakCell) {
                    const decodedAnswer = decodeURIComponent(answer).trim();
                    
                    // Cek apakah jawaban adalah centang (✔️) atau mengandung kata "ya"
                    if (decodedAnswer === '✔️' || decodedAnswer === '✔' || decodedAnswer.toLowerCase() === 'ya') {
                        yaCell.textContent = '✔️';
                        tidakCell.textContent = ''; // Kosong, bukan "-"
                    } 
                    // Cek apakah jawaban adalah silang (berbagai jenis X)
                    // Termasuk: ✖, X, x, Х (Cyrillic X - %D0%A5), ×, atau kata "tidak"
                    else if (decodedAnswer === '✖' || 
                             decodedAnswer === 'X' || 
                             decodedAnswer === 'x' || 
                             decodedAnswer === 'Х' ||  // Cyrillic X
                             decodedAnswer === '×' ||  // Multiplication sign
                             decodedAnswer.toLowerCase() === 'tidak') {
                        yaCell.textContent = ''; // Kosong, bukan "-"
                        tidakCell.textContent = '✖';
                    } 
                    // Jika kosong atau tidak ada jawaban (blank dari URL)
                    else {
                        yaCell.textContent = '-';
                        tidakCell.textContent = '-';
                    }
                }
            }
            
            // Set all answers (q1 to q14)
            for (let i = 1; i <= 14; i++) {
                const answer = params[`q${i}`];
                // Process even if empty (empty means no checkmark)
                console.log(`q${i}: "${answer}" (decoded: "${decodeURIComponent(answer || '')}")`); // Debug log
                setAnswer(i, answer || '');
            }
            
            // Function to setup QR code with signature data
            function setupQRCode(qrId, signatureData) {
                const qrElement = document.getElementById(qrId);
                
                if (signatureData && signatureData !== '') {
                    const decodedSignature = decodeURIComponent(signatureData);
                    const qrData = encodeURIComponent(decodedSignature);
                    const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=50x50&data=${qrData}`;
                    
                    if (qrElement) {
                        qrElement.src = qrUrl;
                        qrElement.onerror = function() {
                            const defaultNames = {
                                'qr1': 'Dibuat%20Oleh',
                                'qr2': 'Diperiksa%20Oleh'
                            };
                            qrElement.src = `https://api.qrserver.com/v1/create-qr-code/?size=50x50&data=${defaultNames[qrId] || 'Signature'}`;
                        };
                    }
                } else {
                    if (qrElement) {
                        const defaultNames = {
                            'qr1': 'Dibuat%20Oleh',
                            'qr2': 'Diperiksa%20Oleh'
                        };
                        qrElement.src = `https://api.qrserver.com/v1/create-qr-code/?size=50x50&data=${defaultNames[qrId] || 'Signature'}`;
                    }
                }
            }
            
            // Function to setup name display
            function setupNameDisplay(nameId, nameParam, sigParam) {
                const nameElement = document.getElementById(nameId);
                
                if (nameElement) {
                    let displayText = '-<br>-';
                    
                    if (nameParam && nameParam !== '') {
                        const decodedName = decodeURIComponent(nameParam);
                        const parts = decodedName.split(' - ');
                        if (parts.length >= 2) {
                            displayText = `${parts[0]}<br>${parts[1]}`;
                        } else {
                            displayText = decodedName.replace(/\s+/g, '<br>');
                        }
                    } 
                    else if (sigParam && sigParam !== '') {
                        const decodedSig = decodeURIComponent(sigParam);
                        const parts = decodedSig.split(' - ');
                        if (parts.length >= 2) {
                            displayText = `${parts[0]}<br>${parts[1]}`;
                        } else {
                            displayText = decodedSig.replace(/\s+/g, '<br>');
                        }
                    }
                    
                    nameElement.innerHTML = displayText;
                }
            }
            
            // Setup QR codes and names
            setupQRCode('qr1', params.sig1 || params.name1);
            setupQRCode('qr2', params.sig2 || params.name2);
            setupNameDisplay('name1', params.name1, params.sig1);
            setupNameDisplay('name2', params.name2, params.sig2);
        })();

        // PDF Export Function
        function exportToPDF() {
            const pdfBtn = document.getElementById('pdfBtn');
            const originalText = pdfBtn.textContent;
            
            if (window.chrome || window.navigator.userAgent.includes('Chrome')) {
                pdfBtn.textContent = 'Generating PDF...';
                pdfBtn.disabled = true;
                
                const buttons = document.querySelector('.buttons');
                buttons.style.display = 'none';
                
                setTimeout(() => {
                    const instruction = confirm(
                        'Untuk menyimpan sebagai PDF:\n\n' +
                        '1. Klik "Print" pada dialog yang akan muncul\n' +
                        '2. Pilih "Save as PDF" atau "Microsoft Print to PDF"\n' +
                        '3. Klik "Save" dan pilih lokasi file\n\n' +
                        'Klik OK untuk melanjutkan...'
                    );
                    
                    if (instruction) {
                        window.print();
                    }
                    
                    setTimeout(() => {
                        buttons.style.display = 'block';
                        pdfBtn.disabled = false;
                        pdfBtn.textContent = originalText;
                    }, 1000);
                    
                }, 100);
                
            } else {
                alert(
                    'Untuk mengexport PDF:\n\n' +
                    '1. Gunakan browser Chrome/Edge untuk hasil terbaik\n' +
                    '2. Atau gunakan "Print Form" lalu pilih "Save as PDF"\n\n' +
                    'Klik OK untuk membuka Print...'
                );
                window.print();
            }
        }
    </script>
</body>
</html>
